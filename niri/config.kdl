// Niri configuration (NEIO navigation, equal halves, SA-prefix bindings)
// ---------------------------------------------------------------------

// ---- Input ----
input {
    keyboard {
        xkb {
            layout "us";
            // Right Alt is now Alt; Compose moved to Menu key
            options "caps:escape,compose:menu";
        }
        repeat-delay 600;
        repeat-rate 25;
    }
}

// ---- Output (example panel; safe to remove if you prefer auto) ----
output "eDP-1" {
    mode "1920x1080@60.000";
    scale 1.0;
    transform "normal";
    position x=0 y=0;
}

// ---- Layout ----
layout {
    gaps 16;
    center-focused-column "never";
    preset-column-widths { proportion 0.5; }
    default-column-width { proportion 0.5; }
}

// ---- Appearance ----
// Solarized Dark color scheme

// Focus ring (indicator around active window)
focus-ring {
    width 4
    // Solarized Dark: base03 (dark teal) for active, base02 for inactive
    active-color "#002b36"      // Solarized Dark teal
    inactive-color "#073642"    // Solarized Dark base02 (slightly lighter)
}

// Window borders (drawn around all windows)
border {
    off  // Disable borders, use focus-ring only for cleaner look
}

// Prefer windows without client-side decorations (cleaner appearance)
prefer-no-csd

// ---- Window rules ----
window-rule {
    match app-id="firefox";
    default-column-width { proportion 0.5; }
}
window-rule {
    match app-id="wezterm";
    default-column-width { proportion 0.5; }
}
window-rule {
    match title="Picture-in-Picture";
    open-floating true;
}

// ---- Keybinds ----
binds {
    // Help / Overview / Centering
    Mod+Alt+Shift+Slash { show-hotkey-overlay; }
    Mod+Alt+Slash       { toggle-overview; }
    Mod+Alt+C           { center-column; }
    Mod+Alt+Shift+C     { center-visible-columns; }

    // Column geometry & display
    Mod+Alt+W           { expand-column-to-available-width; }
    Mod+Alt+Shift+W     { set-column-width "50%"; }
    Mod+Alt+T           { toggle-column-tabbed-display; }

    // Float / Tile controls
    Mod+Alt+F           { move-window-to-floating; }
    Mod+Alt+Shift+F     { move-window-to-tiling; }
    Mod+Alt+Backspace   { switch-focus-between-floating-and-tiling; }

    // Fullscreen / Maximize family
    Mod+Alt+M           { maximize-column; }
    Mod+Alt+Shift+M     { fullscreen-window; }
    Mod+Alt+Ctrl+F      { toggle-windowed-fullscreen; }

    // Quit / Close (guarded)
    Mod+Alt+Q            { close-window; }
    Mod+Alt+Ctrl+Shift+Q { quit; }

    // Launcher / Terminal / Lock
    Mod+Alt+D      { spawn "fuzzel"; }
    Mod+Alt+Return { spawn "wezterm"; }
    Mod+Alt+L      { spawn "wlogout"; }

    // Focus (NEIO + arrows)
    Mod+Alt+Left  { focus-column-left; }
    Mod+Alt+Down  { focus-window-down; }
    Mod+Alt+Up    { focus-window-up; }
    Mod+Alt+Right { focus-column-right; }
    Mod+Alt+N     { focus-column-left; }
    Mod+Alt+E     { focus-window-down; }
    Mod+Alt+I     { focus-window-up; }
    Mod+Alt+O     { focus-column-right; }

    // Move (NEIO + arrows) â€” within current structure
    Mod+Alt+Shift+Left  { move-column-left; }
    Mod+Alt+Shift+Down  { move-window-down; }
    Mod+Alt+Shift+Up    { move-window-up; }
    Mod+Alt+Shift+Right { move-column-right; }
    Mod+Alt+Shift+N     { move-column-left; }
    Mod+Alt+Shift+E     { move-window-down; }
    Mod+Alt+Shift+I     { move-window-up; }
    Mod+Alt+Shift+O     { move-column-right; }

    // Cross-structure moves (SA+Ctrl): insert/eject across columns
    Mod+Alt+Ctrl+N { consume-or-expel-window-left; }
    Mod+Alt+Ctrl+O { consume-or-expel-window-right; }

    // Window-level swap (useful with multi-window columns)
    Mod+Alt+Ctrl+Shift+N { swap-window-left; }
    Mod+Alt+Ctrl+Shift+O { swap-window-right; }

    // Monitors
    Mod+Alt+Comma        { focus-monitor-left; }
    Mod+Alt+Period       { focus-monitor-right; }
    Mod+Alt+Shift+Comma  { move-column-to-monitor-left; }
    Mod+Alt+Shift+Period { move-column-to-monitor-right; }

    // Workspaces
    Mod+Alt+1 { focus-workspace 1; }
    Mod+Alt+2 { focus-workspace 2; }
    Mod+Alt+3 { focus-workspace 3; }
    Mod+Alt+4 { focus-workspace 4; }
    Mod+Alt+5 { focus-workspace 5; }
    Mod+Alt+6 { focus-workspace 6; }
    Mod+Alt+7 { focus-workspace 7; }
    Mod+Alt+8 { focus-workspace 8; }
    Mod+Alt+9 { focus-workspace 9; }
    Mod+Alt+0 { focus-workspace 10; }

    Mod+Alt+Shift+1 { move-column-to-workspace 1; }
    Mod+Alt+Shift+2 { move-column-to-workspace 2; }
    Mod+Alt+Shift+3 { move-column-to-workspace 3; }
    Mod+Alt+Shift+4 { move-column-to-workspace 4; }
    Mod+Alt+Shift+5 { move-column-to-workspace 5; }
    Mod+Alt+Shift+6 { move-column-to-workspace 6; }
    Mod+Alt+Shift+7 { move-column-to-workspace 7; }
    Mod+Alt+Shift+8 { move-column-to-workspace 8; }
    Mod+Alt+Shift+9 { move-column-to-workspace 9; }
    Mod+Alt+Shift+0 { move-column-to-workspace 10; }

    // Sizing
    Mod+Alt+Minus       { set-column-width "-10%"; }
    Mod+Alt+Equal       { set-column-width "+10%"; }
    Mod+Alt+Shift+Minus { set-window-height "-10%"; }
    Mod+Alt+Shift+Equal { set-window-height "+10%"; }

    // Safety
    Mod+Alt+Escape { toggle-keyboard-shortcuts-inhibit; }

    // --- Screenshots: CLIPBOARD ---
    Print             { spawn "sh" "-c" "grim -g \"$(slurp)\" - | wl-copy -t image/png"; } // region
    Mod+Alt+Print     { spawn "sh" "-c" "grim - | wl-copy -t image/png"; }                 // full screen
    Mod+Alt+Shift+Print { spawn "~/.local/bin/niri-screenshot-window.sh"; }                // window

    // --- Screenshots: SAVE TO DISK (Ctrl = save) ---
    Ctrl+Print { spawn "sh" "-c" "mkdir -p \"$HOME/Pictures/Screenshots\" && grim -g \"$(slurp)\" \"$HOME/Pictures/Screenshots/$(date +'%Y-%m-%d_%H-%M-%S_region.png')\""; }
    Mod+Alt+Ctrl+Print { spawn "sh" "-c" "mkdir -p \"$HOME/Pictures/Screenshots\" && grim \"$HOME/Pictures/Screenshots/$(date +'%Y-%m-%d_%H-%M-%S_full.png')\""; }
    Mod+Alt+Ctrl+Shift+Print { spawn "~/.local/bin/niri-screenshot-window-save.sh"; }
} // END binds

// ---- Animations (instant) ----
animations {
    slowdown 1.0;

    workspace-switch         { duration-ms 0; }
    horizontal-view-movement { duration-ms 0; }

    window-open     { duration-ms 0; }
    window-close    { duration-ms 0; }
    window-movement { duration-ms 0; }
    window-resize   { duration-ms 0; }

    config-notification-open-close { duration-ms 0; }
}

// ---- Autostart ----
spawn-at-startup "dbus-update-activation-environment" "--systemd" "WAYLAND_DISPLAY" "XDG_CURRENT_DESKTOP=niri";
// Solarized Dark teal background (#002b36)
spawn-at-startup "swaybg" "-c" "#002b36";
spawn-at-startup "waybar";
spawn-at-startup "mako";
