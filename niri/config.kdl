// Niri configuration (NEIO navigation, equal halves, SA-prefix bindings)
// ---------------------------------------------------------------------

// ---- Input ----
input {
    keyboard {
        xkb {
            layout "us";
            // variant removed - ZMK keyboard handles Colemak-DH
            // Compose on Menu; Caps sends Escape; Right Alt acts as AltGr
            options "caps:escape,compose:menu,lv3:ralt_switch";
        }
        repeat-delay 600;
        repeat-rate 25;
    }

    // Focus follows mouse with scroll limit to prevent unwanted focus jumps
    focus-follows-mouse max-scroll-amount="10%"

    // Mouse settings - flat profile for precise control, fairly fast speed
    mouse {
        accel-profile "flat"
        accel-speed 0.4
        scroll-factor 0.5
    }

    // Touchpad settings
    touchpad {
        scroll-factor 0.1
    }
}

// ---- Output (example panel; safe to remove if you prefer auto) ----
output "eDP-1" {
    mode "1920x1080@60.000";
    scale 1.0;
    transform "normal";
    position x=0 y=0;
}

// ---- Layout ----
layout {
    gaps 16;
    center-focused-column "never";
    preset-column-widths { proportion 0.5; }
    default-column-width { proportion 0.5; }
    default-column-display "tabbed"  // Full-height windows in stacked columns

    tab-indicator {
        hide-when-single-tab
    }

    border {
        off;
    }

    focus-ring {
        width 2;
        active-color "#268bd2";    // Solarized blue
        inactive-color "#073642";  // Solarized base02 (dark teal)
    }
}

prefer-no-csd

// ---- Window rules ----
window-rule {
    match app-id="firefox";
    default-column-width { proportion 0.5; }
}
window-rule {
    match app-id="wezterm";
    default-column-width { proportion 0.5; }
}
window-rule {
    match title="Picture-in-Picture";
    open-floating true;
}

// ---- Keybinds ----
binds {
    // Help / Overview / Centering
    Mod+Slash           { show-hotkey-overlay; }
    Mod+Alt+Slash       { toggle-overview; }
    Mod+Alt+C           { center-column; }
    Mod+C               { center-column; }  // Reliable binding (Mod+Alt unreliable with HRM)
    Mod+Alt+Shift+C     { center-visible-columns; }

    // Jump to column by number (1-indexed)
    Mod+1               { focus-column 1; }
    Mod+2               { focus-column 2; }
    Mod+3               { focus-column 3; }
    Mod+4               { focus-column 4; }
    Mod+5               { focus-column 5; }
    Mod+6               { focus-column 6; }
    Mod+7               { focus-column 7; }
    Mod+8               { focus-column 8; }
    Mod+9               { focus-column 9; }

    // Column geometry & display
    Mod+Alt+W           { expand-column-to-available-width; }
    Mod+Alt+Shift+W     { set-column-width "50%"; }
    Mod+Alt+T           { toggle-column-tabbed-display; }
    Mod+T               { toggle-column-tabbed-display; }  // Simple binding (Mod+Alt unreliable with HRM)

    // Float / Tile controls
    Mod+Alt+F           { move-window-to-floating; }
    Mod+Shift+F         { toggle-window-floating; }  // Reliable binding (Mod+Alt unreliable with HRM)
    Mod+Alt+Shift+F     { move-window-to-tiling; }
    Mod+Alt+Backspace   { switch-focus-between-floating-and-tiling; }

    // Fullscreen / Maximize family
    Mod+Alt+M           { maximize-column; }
    Mod+Alt+Shift+M     { fullscreen-window; }
    Mod+Alt+Ctrl+F      { toggle-windowed-fullscreen; }

    // Quit / Close
    Mod+Q                { close-window; }
    // To quit Niri: niri msg action quit

    // Launcher / Terminal
    Mod+Space      { spawn "fuzzel"; }  // Primary launcher (matches macOS Cmd+Space)
    Mod+Alt+D      { spawn "fuzzel"; }  // Backup binding
    Mod+Alt+Return { spawn "wezterm"; }
    // Power: systemctl poweroff/reboot/suspend, niri msg action quit

    // Focus (NEIO + arrows) - Mod+Shift for consistency
    Mod+Shift+Left  { focus-column-left; }
    Mod+Shift+Down  { focus-window-down-or-top; }
    Mod+Shift+Up    { focus-window-up-or-bottom; }
    Mod+Shift+Right { focus-column-right; }
    Mod+Shift+N     { focus-column-left; }
    Mod+Shift+E     { focus-window-down-or-top; }
    Mod+Shift+I     { focus-window-up-or-bottom; }
    Mod+Shift+O     { focus-column-right; }

    // Window cycling (keyboard compatibility - triggered by S+` on keyboard)
    Mod+Grave       { focus-window-down-or-top; }
    Mod+Shift+Grave { focus-window-up-or-bottom; }

    // Move (NEIO + arrows) â€” within current structure
    Mod+Alt+Shift+Left  { move-column-left; }
    Mod+Alt+Shift+Down  { move-window-down; }
    Mod+Alt+Shift+Up    { move-window-up; }
    Mod+Alt+Shift+Right { move-column-right; }
    Mod+Alt+Shift+N     { move-column-left; }
    Mod+Alt+Shift+E     { move-window-down; }
    Mod+Alt+Shift+I     { move-window-up; }
    Mod+Alt+Shift+O     { move-column-right; }

    // Cross-structure moves (SA+Ctrl): insert/eject across columns
    Mod+Alt+Ctrl+N { consume-or-expel-window-left; }
    Mod+Alt+Ctrl+O { consume-or-expel-window-right; }

    // Window-level swap (useful with multi-window columns)
    Mod+Alt+Ctrl+Shift+N { swap-window-left; }
    Mod+Alt+Ctrl+Shift+O { swap-window-right; }

    // Monitors
    Mod+Alt+Comma        { focus-monitor-left; }
    Mod+Alt+Period       { focus-monitor-right; }
    Mod+Alt+Shift+Comma  { move-column-to-monitor-left; }
    Mod+Alt+Shift+Period { move-column-to-monitor-right; }

    // Workspaces
    Mod+Alt+1 { focus-workspace 1; }
    Mod+Alt+2 { focus-workspace 2; }
    Mod+Alt+3 { focus-workspace 3; }
    Mod+Alt+4 { focus-workspace 4; }
    Mod+Alt+5 { focus-workspace 5; }
    Mod+Alt+6 { focus-workspace 6; }
    Mod+Alt+7 { focus-workspace 7; }
    Mod+Alt+8 { focus-workspace 8; }
    Mod+Alt+9 { focus-workspace 9; }
    Mod+Alt+0 { focus-workspace 10; }

    Mod+Alt+Shift+1 { move-column-to-workspace 1; }
    Mod+Alt+Shift+2 { move-column-to-workspace 2; }
    Mod+Alt+Shift+3 { move-column-to-workspace 3; }
    Mod+Alt+Shift+4 { move-column-to-workspace 4; }
    Mod+Alt+Shift+5 { move-column-to-workspace 5; }
    Mod+Alt+Shift+6 { move-column-to-workspace 6; }
    Mod+Alt+Shift+7 { move-column-to-workspace 7; }
    Mod+Alt+Shift+8 { move-column-to-workspace 8; }
    Mod+Alt+Shift+9 { move-column-to-workspace 9; }
    Mod+Alt+Shift+0 { move-column-to-workspace 10; }

    // Sizing
    Mod+Alt+Minus       { set-column-width "-10%"; }
    Mod+Alt+Equal       { set-column-width "+10%"; }
    Mod+Alt+Shift+Minus { set-window-height "-10%"; }
    Mod+Alt+Shift+Equal { set-window-height "+10%"; }

    // Safety
    Mod+Alt+Escape { toggle-keyboard-shortcuts-inhibit; }

    // Screenshots handled at ZMK keyboard level
} // END binds

// ---- Animations (instant) ----
animations {
    slowdown 1.0;

    workspace-switch         { duration-ms 0; }
    horizontal-view-movement { duration-ms 0; }

    window-open     { duration-ms 0; }
    window-close    { duration-ms 0; }
    window-movement { duration-ms 0; }
    window-resize   { duration-ms 0; }

    config-notification-open-close { duration-ms 0; }
}

// ---- Autostart ----
spawn-at-startup "dbus-update-activation-environment" "--systemd" "WAYLAND_DISPLAY" "XDG_CURRENT_DESKTOP=niri";
// Solarized Dark teal background (#002b36)
spawn-at-startup "swaybg" "-c" "#002b36";
spawn-at-startup "waybar";
spawn-at-startup "mako";
