#!/usr/bin/env nu

# Activity Duration Batch Processor
# Processes ALL markdown files in vault that need activity duration calculation
# Simple approach: scan everything, process what needs processing

def main [] {
    let vault_path = $"($env.HOME)/Forge"
    
    # Find all markdown files in vault
    let files = (glob $"($vault_path)/**/*.md")
    
    let processed_count = 0
    
    for file in $files {
        # Read file content
        let content = (open $file)
        
        # Quick check: does this file have any unprocessed activity entries?
        # Look for patterns like "x:: XXXX-XX" without "min" or "hr" before them
        if ($content =~ '[a-zA-Z]+:: \d{4}-\d{2}') {
            # This file might need processing
            print $"Checking: ($file | path basename)"
            
            # Run the main processor on this file
            ^activity-duration-processor $file
        }
    }
    
    print "Batch processing complete"
}