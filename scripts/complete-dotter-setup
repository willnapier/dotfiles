#!/bin/bash
# Complete Dotter Setup - Unify all configuration management

set -e

echo "🔧 Setting up complete Dotter configuration management..."

# Ensure the semantic search directory exists and is properly linked
DOTFILES_DIR="/dotfiles"
TARGET_DIR="/.local/share/semantic-search"

# Remove existing directory/symlink if it exists
if [[ -e "$TARGET_DIR" ]]; then
    echo "🗑️  Removing existing semantic search directory..."
    rm -rf "$TARGET_DIR"
fi

# Create parent directory
mkdir -p "$(dirname "$TARGET_DIR")"

# Create symlink
echo "🔗 Creating symlink: $TARGET_DIR -> $DOTFILES_DIR/semantic-search"
ln -sf "$DOTFILES_DIR/semantic-search" "$TARGET_DIR"

# Run semantic search setup
echo "📦 Running semantic search setup..."
cd "$TARGET_DIR"
./setup.sh

echo "✅ Complete Dotter setup finished!"
echo ""
echo "All configurations are now managed through dotfiles:"
echo "- Edit files in ~/dotfiles/"
echo "- Changes automatically available via symlinks"
echo "- No more configuration drift"
echo ""
echo "To use semantic search:"
echo "1. Set OPENAI_API_KEY in ~/.config/nushell/env.nu"
echo "2. Run: semantic-rebuild"