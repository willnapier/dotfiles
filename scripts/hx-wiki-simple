#!/bin/bash

# Simple wiki link handler - creates files and reports what to open
line=$(cat)

# Extract wiki link
link=$(echo "$line" | rg -o '\[\[[^]]+\]\]' | head -1 | sd '\[\[(.*)\]\]' '$1')

if [ -z "$link" ]; then
    echo "No wiki link found on this line"
    exit 0
fi

# Clean the link
clean_link=$(echo "$link" | sd '[#|].*' '')

vault="$HOME/Obsidian.nosync/Forge"
file="$vault/$clean_link.md"

# Create the file if it doesn't exist
if [ ! -f "$file" ]; then
    # Ensure directory exists
    mkdir -p "$(dirname "$file")"
    
    # Create basic file
    current_date=$(date "+%Y-%m-%d")
    current_time=$(date "+%H:%M")
    
    cat > "$file" << EOF
---
tags:
- 
date created: $current_date $current_time
date modified: $current_date $current_time
---
# $clean_link

EOF
fi

echo "Created/found: $file"
echo "Use: :open $file"