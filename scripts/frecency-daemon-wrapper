#!/bin/bash
# Cross-platform wrapper script for frecency-daemon
# Handles API key extraction on both macOS and Linux

set -e

# Extract OPENAI_API_KEY from Nushell env-secret (works on both platforms)
ENV_FILE="$HOME/.config/nushell/env-secret.nu"
if [[ -f "$ENV_FILE" ]]; then
    export OPENAI_API_KEY=$(grep 'OPENAI_API_KEY' "$ENV_FILE" | sed 's/.*= *"//' | sed 's/"$//')
fi

# Verify API key is set
if [[ -z "$OPENAI_API_KEY" ]]; then
    echo "ERROR: OPENAI_API_KEY not found" >&2
    exit 1
fi

# Run the daemon
exec ~/.local/bin/frecency-daemon "$@"
