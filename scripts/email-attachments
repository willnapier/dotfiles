#!/usr/bin/env python3
"""Extract attachments from an email file and open them."""
import email
import os
import subprocess
import sys

if len(sys.argv) < 2:
    print("Usage: email-attachments <email-file>")
    sys.exit(1)

path = sys.argv[1]
out_dir = "/tmp/nm-attachments"
os.makedirs(out_dir, exist_ok=True)

with open(path, "rb") as f:
    msg = email.message_from_binary_file(f)

found = []
for part in msg.walk():
    fn = part.get_filename()
    if fn:
        out_path = os.path.join(out_dir, fn)
        with open(out_path, "wb") as out:
            out.write(part.get_payload(decode=True))
        found.append(out_path)
        print(f"Saved: {out_path}")

if found:
    for f in found:
        subprocess.run(["open", f])
else:
    print("No attachments found")
